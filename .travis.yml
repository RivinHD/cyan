language: cpp
compiler: g++
dist: xenial
sudo: required

before_install:
  - sudo apt-get update

install:
  - sudo apt remove --purge imagemagick imagemagick-common
  - sudo apt-get install cmake tree qtbase5-dev libpng-dev libjpeg-dev liblcms2-dev libtiff-dev libbz2-dev zlib1g-dev liblzma-dev
  
script:
  - export CWD=`pwd`
  - git clone https://github.com/ImageMagick/ImageMagick6
  - cd ImageMagick6
  - git checkout 6.9.9-51
  - ./configure --prefix=/usr --enable-hdri --with-quantum-depth=16 --without-x
  - make -j2
  - sudo make install
  - mkdir -p $CWD/ci
  - cd $CWD/ci
  - cmake -DCMAKE_INSTALL_PREFIX=/usr -DBUILD_LIB=ON -DBUILD_CONVERTER=ON -DBUILD_UTILS=ON -DBUILD_TESTS=ON -DUSE_PKGCONFIG=ON ..
  - make
  - make test
  - make DESTDIR=`pwd`/pkg install
  - tree pkg
